import React from 'react';
import { PatientRecord } from '../types';

interface MedicalReportProps {
    record: PatientRecord;
}

const MedicalReport: React.FC<MedicalReportProps> = ({ record }) => {
    const { personalInfo, measurementData, labResults, aiResponse, timestamp } = record;

    return (
        <div className="bg-white p-8 max-w-4xl mx-auto print:p-0 print:max-w-none text-right" dir="rtl">
            {/* Header */}
            <div className="border-b-2 border-gray-800 pb-6 mb-8 flex justify-between items-start">
                <div>
                    <h1 className="text-3xl font-bold text-gray-900">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠ Ù„Ù„Ø­Ù…Ù„</h1>
                    <p className="text-gray-600 mt-2">Smart Pregnancy Assistant - AI Screening Report</p>
                </div>
                <div className="text-left">
                    <p className="text-sm text-gray-500">Date / Ø§Ù„ØªØ§Ø±ÙŠØ®</p>
                    <p className="font-mono font-bold">{timestamp.toLocaleDateString('en-GB')}</p>
                    <p className="text-sm text-gray-500 mt-2">ID / Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</p>
                    <p className="font-mono text-xs">{record.id.slice(0, 8)}</p>
                </div>
            </div>

            {/* Patient Info Grid */}
            <div className="grid grid-cols-2 gap-8 mb-8 bg-gray-50 p-6 rounded-lg print:bg-transparent print:p-0 print:border print:border-gray-200">
                <div>
                    <h3 className="text-sm font-bold text-gray-500 uppercase mb-2">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶Ø©</h3>
                    <p className="font-bold text-lg">{personalInfo.name}</p>
                    <p>Ø§Ù„Ø¹Ù…Ø±: {personalInfo.age} Ø³Ù†Ø©</p>
                    <p>Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ù…Ù„: {personalInfo.pregnancyWeek || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                </div>
                <div>
                    <h3 className="text-sm font-bold text-gray-500 uppercase mb-2">Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©</h3>
                    <p>Ø§Ù„ÙˆØ²Ù†: {measurementData.currentWeight} ÙƒØ¬Ù…</p>
                    <p>Ø§Ù„Ø·ÙˆÙ„: {measurementData.height} Ø³Ù…</p>
                    <p>Ø¶ØºØ· Ø§Ù„Ø¯Ù…: {labResults.systolicBp}/{labResults.diastolicBp} mmHg</p>
                </div>
            </div>

            {/* Risk Assessment Section */}
            <div className="mb-8">
                <h2 className="text-xl font-bold border-b border-gray-300 pb-2 mb-4 flex items-center gap-2">
                    <span>ğŸ“Š</span>
                    ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± (Risk Assessment)
                </h2>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <RiskBox
                        label="ØªØ³Ù…Ù… Ø§Ù„Ø­Ù…Ù„ (Preeclampsia)"
                        score={aiResponse.riskScores.preeclampsiaRisk}
                    />
                    <RiskBox
                        label="Ø³ÙƒØ±ÙŠ Ø§Ù„Ø­Ù…Ù„ (GDM)"
                        score={aiResponse.riskScores.gdmRisk}
                    />
                    <RiskBox
                        label="ÙÙ‚Ø± Ø§Ù„Ø¯Ù… (Anemia)"
                        score={aiResponse.riskScores.anemiaRisk}
                    />
                </div>
            </div>

            {/* AI Analysis Content */}
            <div className="mb-8">
                <h2 className="text-xl font-bold border-b border-gray-300 pb-2 mb-4 flex items-center gap-2">
                    <span>ğŸ“</span>
                    Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª
                </h2>
                <div className="prose max-w-none text-gray-800 leading-relaxed whitespace-pre-wrap">
                    {aiResponse.detailed_report}
                </div>
            </div>

            {/* Footer / Disclaimer */}
            <div className="mt-12 pt-6 border-t border-gray-200 text-center text-xs text-gray-500">
                <p className="font-bold text-red-600 mb-1">âš ï¸ ØªÙ†ÙˆÙŠÙ‡ Ø·Ø¨ÙŠ Ù‡Ø§Ù… / Medical Disclaimer</p>
                <p>
                    Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„ÙØ±Ø² Ø§Ù„Ø£ÙˆÙ„ÙŠ.
                    Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ø§ ØªØ¹ØªØ¨Ø± ØªØ´Ø®ÙŠØµØ§Ù‹ Ø·Ø¨ÙŠØ§Ù‹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ø§ ØªØºÙ†ÙŠ Ø¹Ù† Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ø®ØªØµ.
                    ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ø£Ø¹Ø±Ø§Ø¶ Ø®Ø·ÙŠØ±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ø£Ù‚Ø±Ø¨ Ø·ÙˆØ§Ø±Ø¦ ÙÙˆØ±Ø§Ù‹.
                </p>
                <p className="mt-2 font-mono">Generated by Smart Pregnancy Assistant v1.0</p>
            </div>
        </div>
    );
};

const RiskBox: React.FC<{ label: string; score: number }> = ({ label, score }) => {
    let color = 'bg-green-100 text-green-800 border-green-200';
    let text = 'Ù…Ù†Ø®ÙØ¶ / Low';

    if (score >= 0.7) {
        color = 'bg-red-100 text-red-800 border-red-200';
        text = 'Ø¹Ø§Ù„ÙŠ / High';
    } else if (score >= 0.4) {
        color = 'bg-yellow-100 text-yellow-800 border-yellow-200';
        text = 'Ù…ØªÙˆØ³Ø· / Moderate';
    }

    return (
        <div className={`p-4 rounded-lg border ${color} print:border-gray-300 print:bg-white print:text-black`}>
            <p className="text-sm font-semibold mb-1">{label}</p>
            <div className="flex justify-between items-end">
                <span className="text-xs font-bold uppercase">{text}</span>
                <span className="text-xl font-bold">{(score * 100).toFixed(0)}%</span>
            </div>
        </div>
    );
};

export default MedicalReport;
